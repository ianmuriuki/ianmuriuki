name: Update README with Daily Fact

on:
  schedule:
    - cron: "30 19 * * *"  # Runs daily at 19:30 UTC (22:30 EAT)
  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Fetch a Random Fact
        id: get_fact
        run: |
          fact=$(curl -s https://uselessfacts.jsph.pl/random.json?language=en | jq -r '.text')
          echo "FACT=$fact" >> $GITHUB_ENV

      - name: Update README
        run: |
          awk -v fact="${FACT}" '
            BEGIN { found = 0 }
            {
              if ($0 ~ /^\*\*<b>ðŸ“Œ Daily Fact:<\/b>\*\*/) {
                print "**<b>ðŸ“Œ Daily Fact:</b>** " fact;
                found = 1;
              } else {
                print $0;
              }
            }
            END {
              if (found == 0) {
                print "**<b>ðŸ“Œ Daily Fact:</b>** " fact;
              }
            }
          ' README.md > updated_README.md
          mv updated_README.md README.md

      - name: Commit and Push Changes
        env:
          GH_PAT: ${{ secrets.GH_PAT }}
        run: |
          git config --global user.name "iacbot"
          git config --global user.email "actions@github.com"
          git remote set-url origin https://x-access-token:${GH_PAT}@github.com/${{ github.repository }}
          git add README.md
          git commit -m "Update daily fact" || echo "No changes to commit"
          git push origin main
